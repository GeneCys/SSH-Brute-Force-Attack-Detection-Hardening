# SSH Brute-Force Attack Detection, Remediation and Verification

**SOC-style exercise** simulating a Brute-Force attack on a web server VM and conducting detection, analysis, remediation and reporting.

- **Author:** Gene Crittenden  
- **Date:** 17 November 2025  
- **Web Server VM:** 192.168.56.101  
- **Attacker VM:** 192.168.56.105  

--- 

## Overview

This lab demonstrates how to detect and mitigate SSH brute-force attacks within a controlled virtual environment. Using **Suricata IDS, Wireshark, tcpdump, Hydra**, and **Fail2Ban**, you simulate real-world offensive activity from a **Kali Linux Attacker VM** against a **Linux Web Server** and implement layered defensive controls to stop brute-force attempts.

### Objectives
- Simulate an SSH brute-force attack using Hydra
- Capture and document evidence with Wireshark, tcpdump, and Suricata
- Validate Suricata rules and verify alert generation
- Deploy Fail2Ban to actively mitigate SSH brute-force attempts
- Confirm blocking through firewall rules and re-testing attack attempts
- Document the entire workflow for SOC-style reporting and GRC alignment

**Why This Lab Matters:**  
This exercise simulates a real-world SOC workflow, demonstrating detection, remediation, and verification of Brute-Force Attacks — essential skills for any cybersecurity role.

---

## Lab Setup

Two VMs connected via a host-only VirtualBox network.
| VM                 | IP Address     | Installed Tools | Role                              |
| ------------------ | -------------- | --------------- | --------------------------------- |
| Web Server         | 192.168.56.101 | Suricata, Nginx, Wireshark | Target of attack & generate alerts |
| Kali Linux Attack VM | 192.168.56.105 | Nmap, hydra, wireshark     | Simulate Brute-Force attacks          |

---

## Step 1. Ensure Suricata is updated and working properly on the target **Web Server VM**

```bash
sudo systemctl status suricata
sudo suricata-update
sudo systemctl restart suricata
```

### Optional: Add custom rules to Suricata

<details><summary>Custom Rule</summary>
For demonstration purposes I added my own custom ruleset `local.rules` and created an alert for Brute-Force attempts:
```bash
sudo nano /etc/suricata/rules/local.rules
# Enter in custom rule
alert tcp any any -> $HOME_NET 22 (msg:"LOCAL SSH Brute-Force Attempt"; flow:to_server; detection_filter:track by_src, count 5, seconds 10; sid:900001; rev:1;)
```
Save & exit from `local.rules`, verify that Suricata has loaded the new ruleset before restarting Suricata:
```bash
sudo nano /etc/suricata/suricata.yaml
```
```yaml
# Find:
 rule-files:
  - suricata.rules
  - local.rules
```
```bash
sudo systemctl restart suricata
```
</details>

## Step 2. Verify SSH is Running on the target **Web Server VM**
```bash
sudo systemctl status ssh
sudo systemctl restart ssh
```

## Step 3. Initial Reconnaissance

From the **Kali Linux Attack VM** conduct a version scan on the target **Web Server VM** and save the output.
```bash
nmap -sV -A -p 22 <TARGET-IP> -oN ssh_scan.txt
```
Taking note that SSH is open.

## Step 4. Initiate Brute-Force Attack on the target **Web Server VM**

On the **Kali Linux Attack VM** open **Wireshark** and begin a packet capture on the `host-only` network.  
Then commence the **Brute-Force Attack** using `hydra`.
```bash
hydra -l genecys -P /usr/share/wordlists/rockyou.txt ssh://192.168.56.101
```
- Allow `hydra` to run for 1 - 2 minutes before stopping the attack - the total duration time of a full attack would be far too long for this exercise.

Stop the **Wireshark** packet capture and export for analysis.

## Step 5. Analyse logs and packet captures

Filter for **Brute-Force Attack** evidence in **Wireshark**.

```Wireshark
ssh && tcp contains "ssh"
```

Check the `Suricata` logs for any alerts generated by the attack
```bash
sudo tail -f /var/log/suricata/fast.log
# Save the log for evidence.
sudo cp /var/log/suricata/fast.log ~/suricata_ssh_alerts.log
```
- As expected there are a large number of alerts indicating a **Brute-Force Attack**.

## Step 6. Remediation

Harden the **Web Server VM** to remediate the vulnerability by implementing the following techniques:

### Disable SSH Root Login
<details>

```bash
sudo nano /etc/ssh/sshd_config
```
Edit sshd_config:
```yaml
PermitRootLogin no
```
Restart SSH:
```bash
sudo systemctl restart ssh
```
</details>

### Impliment a Strong Password Policy
<details>

Install password quality tools:
```bash
sudo apt install libpam-pwquality -y
# Edit:
sudo nano /etc/pam.d/common-password
#add or adjust
password requisite pam_pwquality.so retry=3 minlen=12 difok=3
```
</details>

### Limit SSH Login Attempts with Fail2Ban
<details>

Install Fail2Ban:
```bash
sudo apt install fail2ban -y
# Copy the default config
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
```
Edit jail.local so that the [sshd] jail is setup:
```yaml
[sshd]
enabled = true
port = ssh
logpath = /var/log/auth.log
maxretry = 3
bantime  = 10m
findtime  = 10m
```
Start the Fail2Ban service:
```bash
sudo systemctl enable --now fail2ban
```
Finally, check the Fail2Ban service is running ok:
```bash
sudo fail2ban-client status sshd
```
</details>

## Step 7. Verification
Back on the **Kali Linux Attack VM** open a new packet capture on **Wireshark** and run the hydra attack again against the target **Web Server VM** to check remediations have been effective.
```bash
hydra -l genecys -P /usr/share/wordlists/rockyou.txt ssh://192.168.56.101
```
Confirm fail2ban has put the **Kali Linux Attack VM** IP into the banned list. 
```bash
sudo fail2ban-client status sshd
```
- This confirms that fail2ban has worked correctly and banned the IP the attack originated from. 

Check the Suricata and Wireshark logs to correlate the mitigations have been effective.  
- Noticed a significant reduction in suricata alerts being generated which supports the mitigations effectiveness.
- Noted far fewer entries in the Wireshark packet capture indicating the packets are being silently dropped.

--- 

## GRC Mapping

This section maps the lab activities to common governance, risk, and compliance (GRC) frameworks, demonstrating how technical SOC operations support organizational compliance and policy requirements.
<details><summary>GRC Mapping</summary>

| Control Framework | Relevant Control               | How This Lab Satisfies It                         |
| ----------------- | ------------------------------ | ------------------------------------------------- |
| **NIST CSF**      | PR.AC-1 (Access Control)       | Hardened SSH, reduced attack surface              |
|                   | DE.CM-1 (Monitoring)           | Suricata detects brute-force attempts             |
|                   | DE.AE-2 (Threat Detection)     | IDS produces actionable alerts                    |
|                   | PR.PT-3 (Access Restrictions)  | Fail2Ban prevents unauthorized access             |
| **ISO 27001**     | A.8.20 (Logging)               | Suricata logs + auth logs retained                |
|                   | A.8.16 (Monitoring Activities) | Continuous monitoring of SSH attempts             |
|                   | A.8.18 (Preventing Misuse)     | Fail2Ban bans malicious IPs                       |
| **MITRE ATT&CK**  | T1110 (Brute Force)            | Attack simulation replicates brute-force behavior |
|                   | D3-FA (Network: IDS)           | Suricata detects SSH brute-force traffic          |

**Purpose of Mapping:**
- Demonstrates that technical controls (Suricata IDS + monitoring) support compliance requirements.
- Provides documentation evidence for audits and regulatory reporting.
- Links SOC detection activity to standardized GRC frameworks, strengthening organizational security posture.
</details>

---

## Skills Demonstrated
- **Threat Simulation:** Executed SSH brute-force attacks using Hydra to emulate attacker behavior and validate defensive monitoring.
- **Network Traffic Analysis:** Captured and analyzed SSH authentication traffic using Wireshark and tcpdump with protocol-specific filters.
- **Intrusion Detection:** Configured and validated Suricata IDS to detect SSH brute-force attempts and generate meaningful alert logs.
- **Rule Management:** Troubleshot Suricata rule paths, enabled ET/Open sources, verified rule loading, and debugged configuration issues.
- **Log Analysis:** Interpreted Suricata fast.log, system authentication logs, Fail2Ban logs, and firewall events for root-cause analysis.
- **Incident Response Mindset:** Identified malicious SSH activity, confirmed impact, validated alerts, and performed containment actions.
- **System Hardening:** Applied SSH configuration hardening (disable root login, limit auth attempts, enforce key-based auth).
- **Automated Mitigation:** Deployed and tuned Fail2Ban to detect repeated failed SSH attempts and automatically ban malicious IPs.
- **Firewall Management:** Verified active Fail2Ban iptables/nftables rules blocking attacker IPs at the host network layer.
- **Documentation & Evidence Collection:** Recorded all relevant packet captures, alerts, command outputs, and mitigation steps following SOC-style practices.

---

## Lessons Learned
- IDS visibility is independent of firewall blocking: Suricata still logs brute-force traffic even when Fail2Ban blocks the IP, because dropped packets still appear at the network layer.
- Misconfigured rule paths prevent detection: Suricata will silently fail to load rules if rule directories, filenames, or YAML indentation are incorrect.
- Duplicate Fail2Ban jail definitions break the entire service: Having multiple [sshd] blocks caused “async server failed” errors — strict configuration hygiene is essential.
- Fail2Ban only works when logs are readable: It relies entirely on parsing /var/log/auth.log; misconfigured or moved logs can disable detection.
- SSH hardening drastically reduces attack surface: Disabling root login and password authentication eliminates most brute-force attack vectors.
- Packet capture tools confirm assumptions: tcpdump and Wireshark were critical for validating that SSH attempts were reaching the server and for verifying Fail2Ban’s effectiveness.
- Layered security is more effective than single controls: IDS + logging + SSH configuration + Fail2Ban gives detection, insight, and active blocking — none of these alone provides full protection.
- Small syntax errors cause big failures: YAML indentation and commented headers (#) in `jail.local` had oversized impact on IDS and Fail2Ban behavior.
- Testing controls with real attacks is invaluable: Simulating brute-force attempts provided immediate feedback about which defensive controls were effective and which weren’t.

--- 

## Supporting Files
**Reports**
- [Incident Report](./incident_report.md)
- [GRC Report](./grc_report.md)

[Logs](./logs)
- Nmap Scans & Wrieshark Packet Captures
  - _The original .pcapng file is kept offline and available upon request._

[Screenshots](./screenshots)
- Nmap Scans & Wireshark Filters

---

**End of Report**
